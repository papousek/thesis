\chapter{Pojmy a východiska}

Následující kapitola se věnuje základním pojmům nutným k~pochopení
algoritmu pro analýzu dynamických systémů uvedeného v kapitole \ref{chapter:algorithm}
a~kontextu, v jakém byl navržen. Jedná se zejména o popis reprezentace zkou\-ma\-ných
modelů a požadovaných vlastností.

%\section{Systémová biologie}

\section{Modelování}

Před popisem samotného modelování pomocí obyčejných diferenciálních rovnic je
nutné říci, co se od vytvářených modelů zpravidla očekává. Model zpro\-středko\-vá\-vá
zjednodušený pohled na zkoumaný systém a umožňuje tím systém snáze pochopit a
případně předpovídat některé jevy. Fakt, že model je jen zjednodušením, znamená,
že se vždy od reality liší a nabízí pouze jen některé aspekty chování zkoumaného
systému. [str. 48]

% Priklad modelu mapa, modelujeme problem ne system

Jednoduchým příkladem modelu je mapa. Zřejmě nemůžeme očekávat od mapy, aby obsahovala
všechny skutečnosti zahrnuté ve skutečném světě. Svým způsobem je mapa již od počátku
\uv{špatně}, nabízí pouze jistou abstrakci systému a může i zkreslovat náš pohled.
Přesto nelze popírat její užitečnost. Na mapě si lze také ukázat fakt, že se
nemodeluje systém, ale problém. Existuje celá řada druhů map od turistických, automap
až po map podloží a každá z nich má svůj specifický účel. \cite[str. 47 -- 58]{pelanek2012}

Pro tuto práci jsou důležité modely, které lze simulovat. Model definuje pravidla, podle
kterých se systém chová a simulace umožňuje se podívat na chování systému v čase, ať už
diskrétním či spojitém. Pro simulace je sa\-mozřej\-mě potřeba znát stav systému, od kterého
se jeho další chování odvíjí.

\subsection{Modelování pomocí obyčejných diferenciálních rovnic}

Hojně užívaným způsobem modelování, kde vystupuje spojitý čas, jsou diferenciální rovnice.
Stav systému se vyjádří pomocí stavových pro\-měn\-ných $\mathbf{X} = (\mathit{x_1}, \mathit{x_2}, \dots \mathit{x_n})$.
Každé stavové proměnné přísluší diferenciální rovni\-ce prvního řádu, ve které vystupue
Lipschitzovsky spojitá \cite[str. 149 -- 163]{eriksson2004} funkce
$f_i: [t, \infty) \times \mathbb{R}^n \rightarrow \mathbb{R}$, která popisuje,
jak se stavová proměnná mění v čase. Tvar takové rovnice je vidět ve sché\-ma\-tu~\ref{eq:ode}.

\begin{align}\label{eq:ode}
\frac{d\mathit{x_i}}{dt} = f_i(t, \mathbf{X})
\end{align}

Pro účely simulce není nutné znát úplné řešení této soustavy rovnic, ale postačuje pouze znalost
vývoje systému od počatečního času $t_0$, kterému odpovídá počáteční stav $\mathbf{X}(t_0)$.
V praxi se setkáváme s tím, že neznáme ani tento přesný vývoj, nýbrž pouze jeho aproximaci,
kterou poskytují metody pro řešení problému výchozích podmínek~\cite{iserles1996}.

Tyto metody hledají aproximaci v diskrétním čase a chyba, s níž se vy\-po\-čí\-ta\-ná
aproximace liší od skutečného řešení, je shora ohraničená uživatelem danou hodnotou.
Fakt, že si může uživatel takto nadefinovat toleranci chyby, je je jednou z nejdůležitějších
vlastností těchto metod. Nastavení chyby může samozřejmě v případě nízké tolerance
a některých systémů vyústit ve výkonostní problémy. Jestliže tedy zvolíme časový
krok $h \in \mathbb{R}$, pak výstupem těchto metod je sekvence bodů $\mathbf{X_0}, \mathbf{X_1}$, \ldots,
pro kterou platí vztah \ref{eq:ode:aprox}.

\begin{align}\label{eq:ode:aprox}
\mathbf{X}_i \sim \mathbf{X}(t_i) \textrm{ kde } t_i = t_0 + i \cdot h, i \in \mathbb{N}
\end{align}

% Priklad modelu ve spojitem case

\subsection{Příklad modelu}\label{section:lotkav}

Známým modelem využívající soustavy diferenciálních rovnic popisuje vztah predátora
a kořisti \cite{lotka1925} definovaný rovnicemi \ref{eq:lotkav}. Obsahuje stavové pro\-měn\-né
pro množství kořisti ($x$) a počet predátorů ($y$), dále parametry pro přirozený
přírůstek kořisti ($\alpha$), \uv{žravost} predátorů ($\beta$), přirozený úbytek
predátorů ($\gamma$) a schopnost reprodukce predátorů ($\delta$).

\begin{align}\label{eq:lotkav}
\begin{array}{ll}
\frac{dx}{dt} &= x\cdot(\alpha - \beta \cdot y)			\\
\frac{dy}{dt} &= -y \cdot (\gamma - \delta \cdot x)
\end{array}
\end{align}

Model je samozřejmě zjednodušením reality. V systému se nacházejí pouze dva druhy
zvířat, bíložravá kořist a masožravý predátor. U kořisti se předpokládá bezproblémový
přístup k potravě, a proto přirozeně příbívá. Naproti tomu reprodukce predátora je
závislá na přísunu masité potravy, tzn. množství kořisti v systému.

I na tomto modelu je však možné pozorovat netriviální chování, o čemž se lze přesvědčit
při pohledu na grafy  \ref{fig:lotkav:timeserie} a \ref{fig:lotkav:oscil}. Systém má
tendenci oscilovat. Periodicky dochází k nárustu populace predátora, to vyústí v pokles
populace kořisti, následně u predátorů v důsledku nedostatku potravy převáží úmrtnost nad reprodukcí,
množství kořisti opět naroste a tento cyklus se znovu opakuje.

\begin{figure}[h!]
\begin{center}
\subfigure[vývoj systému v čase]{
	\includegraphics[width=.48\textwidth]{../images/lotkav-timeserie.png}\label{fig:lotkav:timeserie}
}
\subfigure[stavy, kterými systém prochází]{
	\includegraphics[width=.48\textwidth]{../images/lotkav-oscil.png}\label{fig:lotkav:oscil}
}
\end{center}
\caption{Model systému obsahující predátora a kořist s ohodnocením parametrů $\alpha = 2$,  $\beta = 0.5$, $\gamma = 0.2$ a $\delta = 0.6$.}
\end{figure}

Síla modelů a simulace se ukazuje být v tom, že tento druh informace získáme, aniž bychom prováděli
experiment například se skutečnými liš\-ka\-mi a zajíci. Samozřejmě se na závěr neobejdeme
bez validace výsledků simulace se skutečným systémem, ale tomu může předcházet velké množství
experementů \textit{in silico}, které by nás jinak stáli mnoho prostředků nebo by ani 
nebyly uskutečnitelné. Za zmínku stojí například model popisující šíření nákazy
populací~\cite{kermack1927}, což je téma, u něhož si opravdu lze jen těžko představit
experimenty na reálném systému.

\subsection{Modelování chemických reakcí}

Modelování pomocí obyčejných diferenciálních rovnic je natolik obecný a účinný nástroj,
že jej lze použít pro popis jevů z mnoha oblastí. Jednou z typických oblastí, kde
se rovnice používají, jsou chemické reakce. Pro systém elementárních chemických reakcí
lze za jistých předpokladů \cite{TODO} automatizovaně zkonstruovat systém diferenciálních rovnic,
kde stavovými proměnnými jsou koncentrace jednotlivých látek. Elementárními che\-mic\-ký\-mi
reakcemi se mají na mysli ty chemické reakce, u nichž dochází k přímé přeměně reaktantů
v produkty bez reakčních mezikroků nebo je možné tyto mezikroky zanedbat \cite{TODO}.
Schémata \ref{eq:chemeq} ukazují, jak tento převod konkrétně vypadá pro jednotlivé
elementární chemické reakce a specifickou kinetickou konstantu $k$. Koncentraci látky
$\textrm{X}$ značíme $[\textrm{X}]$.

\begin{align}\label{eq:chemeq}
\begin{array}{ll}
\xrightarrow{k} A			&\leadsto \frac{d[\textrm{A}]}{dt} = k						\\
A \xrightarrow{k} 			&\leadsto \frac{d[\textrm{A}]}{dt} = - k \cdot [\textrm{A}]	\\
A \xrightarrow{k} B			&\leadsto \frac{d[\textrm{A}]}{dt} = - k \cdot [\textrm{A}], \frac{d[\textrm{B}]}{dt} = k \cdot [\textrm{A}] \\
AB \xrightarrow{k} A + B	&\leadsto \frac{d[\textrm{AB}]}{dt} = - k \cdot [\textrm{AB}], \frac{d[\textrm{A}]}{dt} = \frac{d[\textrm{B}]}{dt} = k \cdot [\textrm{A}] \\
A + B \xrightarrow{k} AB	&\leadsto \frac{d[\textrm{A}]}{dt} = \frac{d[\textrm{B}]}{dt} = - k \cdot [\textrm{A}] \cdot [\textrm{B}], \frac{d[\textrm{AB}]}{dt} = k \cdot [\textrm{A}] \cdot [\textrm{B}] \\
A + B \xrightarrow{k} AB	&\leadsto \frac{d[\textrm{A}]}{dt} = - 2k \cdot [\textrm{A}]^2, \frac{d[\textrm{AB}]}{dt} = k \cdot [\textrm{A}]^2 \\
\end{array}
\end{align}

Pro obecné reakce abstrahující určitou kaskádu elementárních reakcí univerzální
převod neexistuje. Zde je již nutné přihlédnout k typu reakce. Tím, že se
zanedbají mezireakce s meziprodukty, může výsledný systém diferenciálních rovnic obsahovat
méně proměnných a je tak snazší jej simulovat.

\section{Vlastnosti modelovaných systémů}

Aby bylo možné modely automatizovaně analyzovat, je nutné vyjadřovat se o jejich
vlastnostech exatně. Jazyk, který je k tomuto účely potřeba, musí být schopen 
popsat chování systému. V kontextu obyčejných a di\-fe\-ren\-ci\-ál\-ních rovnic je
chováním trajektorie, v případě simulace sekvence bodů v~čase. Například u modelu
popsaného v sekci \ref{section:lotkav} je vhodné popsat oscilaci populace kořisti
nebo predátora. To lze například tak, že budeme požadovat, aby množství jedinců
daného druhu přesáhlo opakovaně pře\-sáh\-lo maximální a minimální mez. Jak konkrétně
tento požadavek zformulovat, je ukázáno dále.

%Pro použití této logiky je nejprve
%nutné definovat tzv. atomické propozice, což jsou vlastnosti, které lze přisoudit jednotlivým stavům,
%například \uv{množství kořisti je větší než 100} nebo \uv{množství kořisti je menší než 10}.
%V případě modelů založených na diferenciálních rovnicích jsou atomické propozice tvaru $g(\mathbf{X})~\rho~k$,
%kde $\mathbf{X} = (x_1, x_2, \ldots, x_n)$ je vektor stavových proměnných,
%$g: \mathbb{R}^n \rightarrow \mathbb{R}$ funkce,
%$k\in\mathbb{R}$ konstanta a $\rho \in \{\leq, =, \geq\}$. Vzhledem k tomu,
%že simulace podléhá určité chybě, není vhodné používat rovnost, a proto se v~této
%práci omezíme na $\rho \in \{\leq, \geq\}$.

K vyjádření vlastností nad lineárními běhy systémů se nejčastěji používá lieární
temporální logika~\cite{strejcek2007}, případě logiky z ní odvozené.
Lineární temporální logika u\-mož\-ňu\-je se zjednodušeně vyjadřovat o sta\-vech
systému v čase formulacemi typu \uv{v budoucnu nastane \ldots}, \uv{vždy platí \ldots} apod.
Tato logika se definuje nad nekonečnými běhy, a proto je v~této práci použita temporální logika
signálů~\cite{maler2004} založená na temporální logice metrických intervalů~\cite{alur1996},
která se od lineární temporální logiky liší pouze přidáním ča\-so\-vých intervalů. Tím temporální
logika signálů u\-mož\-ňu\-je formulovat výroky, které jsou částečně závislé na čase jako
je například \uv{za hodinu až dvě nastane \ldots} \uv{za třicet minut bude celé
čtyři hodiny platit \ldots}.

\subsection{Signál}

Zvolme si časovou doménu $\mathbb{T} = \mathbb{R}_{\geq 0}$ a signál konečné délky
nad libovolnou doménou $\mathbb{D}$ jako parciální zobrazení $s: \mathbb{T} \rightarrow \mathbb{D}$.
Definičním oborem tohoto zobrazení nechť je interval $l = [0, r)$, kde $r \in \mathbb{Q}_{\geq0}$ nazáváme
délkou signálu a značíme ji $|s| = r$. Pro všechna $t \geq r$ položíme $s[t] = \bot$.

Tyto signály lze sdružovat pomocí párovací funkce $||$.

\begin{align}\label{eq:signals:pairing}
\begin{array}{ll}
s_1: \mathbb{T} \rightarrow \mathbb{D}_1, s_2: \mathbb{T} \rightarrow \mathbb{D}_2	\\
s_1 || s_2: \mathbb{T} \rightarrow \mathbb{D}_1 \times\mathbb{D}_2		\\
s_1 || s_2= s_{12}\textrm{, kde }\forall t\in\mathbb{T}. s_{12}[t] = (s_1[t] \times s_2[t])
\end{array}
\end{align}

Standardní cestou lze na těchto sdružených signálech definovat projekční funkce.

\begin{align}\label{eq:signals:pairing}
\begin{array}{ll}
s_1 = \pi_1(s_{12})		& s_2 = \pi_2(s_{12})
\end{array}
\end{align}

Pro případ, že se délky skládaných signálů liší, definujeme výslednou délku
složeného signálu jako $|s_{12}| = min(|s_1|, |s_2|)$ a při aplikaci libovolé
funkce $f: \mathbb{D}_1 \times \mathbb{D}_2 \rightarrow \mathbb{D}_3$
položíme $f(s_1, s_2) = f(s_1[t], s_2[t]$ pro všechna $t \in \mathbb{T}$ a
$f(x_1, \bot) = f(\bot, x_2) = \bot$.

Je dobré si povšimnou, že definice signálu je konzistentní s tím, jak chápeme chování modelu,
tedy jako trajektorii v $\mathbb{R}^n$, kde $n$ je počet sta\-vo\-vých proménných. Zároveň
je třeba si však uvědomit, že výstupem numerické simulace není spojitá trajektorie, nýbrž pouze
sekvence bodů s~časovým razítkem.

\subsection{Temporální logika signálů}
Důležitým aspektem zde použité logiky jsou uzavřené časové intervaly $I = [a, b]$, kde $a, b \in \mathbb{Q}_{\geq0}$,
jimiž jsou omezeny všechny temporální operátory. Konečnost intervalů je jedním z rozdílů
oproti klasické temporální logice metrických intervalů. Toto omezení je plně v souladu s tím,
že modely porovnáváme s reálnými systémy, které pozorujeme konečný čas, a značně tento předpoklad
zjedno\-du\-ší další analýzu.

Nechť $U = \{\mu_1, \mu_2, \mu_3, \ldots, \mu_k\}$ je množina efektivně vyčíslitelných funkcí
$\mu_i: \mathbb{R}^n \rightarrow \{T, F\}$, které zpravidla odpovídají predikátům tvaru
$f(\mathbf{X})~\geq~k$ nebo $f(\mathbf{X})~\leq~k$. Všimněme si, že nemá smysl v predikátech
používat samotnou rovnost, protože numerická simulace vrací data s~určitou chybou.
K těmto atomickým propozicím přísluší signály $s = \mu_1(x)|| \ldots|| \mu_k(x)$.

Gramatiku temporální logiky signálů definujeme podle předpisu \ref{eq:stl:grammar},
ve kterém $p$ značí atomickou propozici.

\begin{align}\label{eq:stl:grammar}
\varphi := T~|~p~|~\neg\varphi~|~\varphi_1 \wedge \varphi_2~|~\varphi_1\mathcal{U}_{[a,b]}\varphi_2
\end{align}

Ze základních formulí lze odvodit další standardně používané výrokové a temporální operátory.
Nejpožívanějšími jsou výrokový operátor $\vee$ a temporální operátory $\mathcal{F}$ a $\mathcal{G}$,
které intuitivně odpovídají už zmíněným výrokům \uv{v budoucnu nastane \ldots} a \uv{vždy platí \ldots}.

\begin{align}\label{eq:stl:other}
\begin{array}{ll}
\varphi_1\vee\varphi_2 		&\equiv \neg\varphi_1 \wedge \neg\varphi_2		\\
\mathcal{F}_{[a,b]}\varphi 	&\equiv T\mathcal{U}_{[a,b]}\varphi				\\
\mathcal{G}_{[a,b]}\varphi 	&\equiv \neg\mathcal{F}_{[a,b]}\neg\varphi		\\
\end{array}
\end{align}

Re\-la\-ce $(s, t) \models \varphi$ značí, že daný signál $s$ splňuje formuli $\varphi$
počínaje pozicí v čase $t$, a je definována induktivně předpisem \ref{eq:stl:semantics}.
$P(s, t)$ představuje množinu atomických propozic platných v čase $t$ na signálu $s$.
Signál $s$ splňuje formuli $\varphi$ právě tehdy, když $(s, 0) \models \varphi$.

\begin{align}\label{eq:stl:semantics}
\begin{array}{ll}
(s, t) \models p				&\longleftrightarrow \pi_p(s)[t] = T			\\
(s, t) \models \neg \varphi		&\longleftrightarrow (s, t) \not\models \varphi	\\
(s, t) \models \varphi_1 \wedge \varphi_2	&\longleftrightarrow (s, t) \models \varphi_1 \textrm{ a současně } (s, t) \models \varphi_2	\\
(s, t) \models \varphi_1 \mathcal{U}_{[a,b]} \varphi_2 	&\longleftrightarrow \exists t' \in [t+a, t+b] . (s, t') \models \varphi_2			\\														
&~~~~~~~~\textrm{ a současně } \forall t'' \in [t, t'] . (s, t'') \models \varphi_1
\end{array}
\end{align}

Stojí za zmínku, že operátor $\mathcal{U}$ je zde definován s trochu jinou sémantikou
než je běžné. Požaduje se zde silnější podmínka, tj. aby existoval stav (čas),
pro který platí obě vlastnosti $\varphi_1$ a $\varphi_2$, tedy aby existoval
čas $t' \in [t + a, t + b]$ takový, že $(s, t') \models \varphi_1$
a současně $(s, t') \models \varphi_2$. To však nemění sémantiku ostatních známých
temporálních operátorů $\mathcal{F}$ a $\mathcal{G}$.

\begin{align}\label{eq:stl:semantics}
\begin{array}{ll}
(s, t) \models \mathcal{F}_{[a,b]}\varphi &\longleftrightarrow	\exists t'\in[t+a, t+b].(s,t') \models \varphi		\\
(s, t) \models \mathcal{G}_{[a,b]}\varphi &\longleftrightarrow	\forall t'\in[t+a, t+b].(s,t') \models \varphi
\end{array}
\end{align}

Standardní sémantika temporálních logik obecně neumožňuje ověření platnosti temporálních operátorů
na konečných signálech kromě některých případů, jako je splněnost $\mathcal{F}\varphi$
nebo nesplněnost $\mathcal{G}\varphi$, jejichž platnost může být ověřena v konečném čase.
Tento problém naštěstí odpadá zavedením časových intervalů. I přesto však existují
formule a signály, u kterých o platnosti rozhodnot nelze. Příkladem může být formule $F_{[a, b]}\varphi$
a signál o délce kratší než $b$.

Z tohoto důvodu se definuje délka nezbytná k ověření platnosti dané formule nad daným signálem.

\begin{align}\label{eq:stl:min:length}
\begin{array}{ll}
||p||									&= 0									\\
||\neg\varphi||							&= ||\varphi||							\\
||\phi_1 \wedge \phi_2||				&= max(||\varphi_2||,||\varphi_2||) 	\\
||\phi_1 \mathcal{U}_{[a,b]} \phi_2||	&= max(||\varphi_2||,||\varphi_2||) + b	\\
\end{array}
\end{align}

\subsection{Příklady vlastností}

\subsection{Ověření platnosti}
